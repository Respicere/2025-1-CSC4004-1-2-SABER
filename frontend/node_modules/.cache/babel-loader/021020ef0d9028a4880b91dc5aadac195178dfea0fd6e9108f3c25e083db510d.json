{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\82102\\\\Downloads\\\\2025-1-CSC4004-1-2-SABER-main\\\\2025-1-CSC4004-1-2-SABER-main\\\\frontend\\\\src\\\\pages\\\\SellerCameraScreen.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport '../css/Sellers.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction SellerCameraScreen() {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const navigate = useNavigate();\n  const [stream, setStream] = useState(null);\n\n  // 1. 카메라 접근 및 스트림 관리 useEffect\n  useEffect(() => {\n    const startCamera = async () => {\n      try {\n        const mediaStream = await navigator.mediaDevices.getUserMedia({\n          video: true\n        });\n        if (videoRef.current) {\n          // videoRef.current가 null이 아닐 때만 srcObject 설정\n          videoRef.current.srcObject = mediaStream;\n        }\n        setStream(mediaStream);\n      } catch (err) {\n        console.error('카메라 접근 오류:', err);\n        // 사용자에게 카메라 접근이 거부되었음을 알리거나, 대체 UI를 제공할 수 있습니다.\n        // 예: alert('카메라 접근이 거부되었습니다. 설정을 확인해주세요.');\n        // navigate('/permission-denied'); // 권한 거부 시 특정 페이지로 이동\n      }\n    };\n    startCamera();\n\n    // 클린업 함수: 컴포넌트 언마운트 시 카메라 스트림 중지\n    return () => {\n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n      }\n    };\n  }, [stream]); // stream이 변경될 때만 다시 실행\n\n  // 2. 보안 위험 감지 useEffect (추가된 부분)\n  useEffect(() => {\n    const handleSecurityRisk = () => {\n      // 카메라 스트림이 활성화되어 있다면 중지\n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n        setStream(null); // 스트림 상태 초기화\n      }\n      navigate('/capture-warning'); // 경고 페이지로 이동\n    };\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'hidden') {\n        handleSecurityRisk();\n      }\n    };\n    const handleBlur = () => {\n      handleSecurityRisk();\n    };\n    window.addEventListener('blur', handleBlur);\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () => {\n      window.removeEventListener('blur', handleBlur);\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, [navigate, stream]); // navigate와 stream을 의존성 배열에 추가\n\n  const handleCapture = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    if (video && canvas) {\n      const context = canvas.getContext('2d');\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\n      const image = canvas.toDataURL('image/png');\n      localStorage.setItem('capturedImage', image);\n\n      // 캡처 후 스트림 중지 (선택 사항)\n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n        setStream(null); // 스트림 상태 초기화\n      }\n      navigate('/seller/verification-complete');\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"captureContainer\",\n    children: [!stream && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cameraLoading\",\n      children: \"\\uCE74\\uBA54\\uB77C \\uB85C\\uB529 \\uC911... \\uB610\\uB294 \\uCE74\\uBA54\\uB77C \\uC811\\uADFC\\uC744 \\uD5C8\\uC6A9\\uD574\\uC8FC\\uC138\\uC694.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 19\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      autoPlay: true,\n      playsInline: true,\n      className: \"video\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'none'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleCapture,\n      className: \"captureButton\",\n      disabled: !stream\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cameraLabel\",\n      children: \"\\uC0AC\\uC9C4 \\uCD2C\\uC601\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n}\n_s(SellerCameraScreen, \"gSGdX3v7huVqQAaCYck8aRG02fE=\", false, function () {\n  return [useNavigate];\n});\n_c = SellerCameraScreen;\nexport default SellerCameraScreen;\nvar _c;\n$RefreshReg$(_c, \"SellerCameraScreen\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useNavigate","jsxDEV","_jsxDEV","SellerCameraScreen","_s","videoRef","canvasRef","navigate","stream","setStream","startCamera","mediaStream","navigator","mediaDevices","getUserMedia","video","current","srcObject","err","console","error","getTracks","forEach","track","stop","handleSecurityRisk","handleVisibilityChange","document","visibilityState","handleBlur","window","addEventListener","removeEventListener","handleCapture","canvas","context","getContext","width","videoWidth","height","videoHeight","drawImage","image","toDataURL","localStorage","setItem","className","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","playsInline","style","display","onClick","disabled","_c","$RefreshReg$"],"sources":["C:/Users/82102/Downloads/2025-1-CSC4004-1-2-SABER-main/2025-1-CSC4004-1-2-SABER-main/frontend/src/pages/SellerCameraScreen.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport '../css/Sellers.css';\n\nfunction SellerCameraScreen() {\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const navigate = useNavigate();\n  const [stream, setStream] = useState(null);\n\n  // 1. 카메라 접근 및 스트림 관리 useEffect\n  useEffect(() => {\n    const startCamera = async () => {\n      try {\n        const mediaStream = await navigator.mediaDevices.getUserMedia({ video: true });\n        if (videoRef.current) { // videoRef.current가 null이 아닐 때만 srcObject 설정\n          videoRef.current.srcObject = mediaStream;\n        }\n        setStream(mediaStream);\n      } catch (err) {\n        console.error('카메라 접근 오류:', err);\n        // 사용자에게 카메라 접근이 거부되었음을 알리거나, 대체 UI를 제공할 수 있습니다.\n        // 예: alert('카메라 접근이 거부되었습니다. 설정을 확인해주세요.');\n        // navigate('/permission-denied'); // 권한 거부 시 특정 페이지로 이동\n      }\n    };\n\n    startCamera();\n\n    // 클린업 함수: 컴포넌트 언마운트 시 카메라 스트림 중지\n    return () => {\n      if (stream) {\n        stream.getTracks().forEach((track) => track.stop());\n      }\n    };\n  }, [stream]); // stream이 변경될 때만 다시 실행\n\n  // 2. 보안 위험 감지 useEffect (추가된 부분)\n  useEffect(() => {\n    const handleSecurityRisk = () => {\n      // 카메라 스트림이 활성화되어 있다면 중지\n      if (stream) {\n        stream.getTracks().forEach((track) => track.stop());\n        setStream(null); // 스트림 상태 초기화\n      }\n      navigate('/capture-warning'); // 경고 페이지로 이동\n    };\n\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'hidden') {\n        handleSecurityRisk();\n      }\n    };\n\n    const handleBlur = () => {\n      handleSecurityRisk();\n    };\n\n    window.addEventListener('blur', handleBlur);\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n\n    return () => {\n      window.removeEventListener('blur', handleBlur);\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, [navigate, stream]); // navigate와 stream을 의존성 배열에 추가\n\n  const handleCapture = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    if (video && canvas) {\n      const context = canvas.getContext('2d');\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\n      const image = canvas.toDataURL('image/png');\n      localStorage.setItem('capturedImage', image);\n\n      // 캡처 후 스트림 중지 (선택 사항)\n      if (stream) {\n        stream.getTracks().forEach((track) => track.stop());\n        setStream(null); // 스트림 상태 초기화\n      }\n\n      navigate('/seller/verification-complete');\n    }\n  };\n\n  return (\n    <div className=\"captureContainer\">\n      {/* 카메라 스트림이 없을 때 로딩 메시지 또는 에러 메시지 표시 가능 */}\n      {!stream && <div className=\"cameraLoading\">카메라 로딩 중... 또는 카메라 접근을 허용해주세요.</div>}\n      <video ref={videoRef} autoPlay playsInline className=\"video\" />\n      <canvas ref={canvasRef} style={{ display: 'none' }} />\n      {/* 스트림이 활성화되었을 때만 캡처 버튼 활성화 */}\n      <button onClick={handleCapture} className=\"captureButton\" disabled={!stream} />\n      <div className=\"cameraLabel\">사진 촬영</div>\n    </div>\n  );\n}\n\nexport default SellerCameraScreen;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}